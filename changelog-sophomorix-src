This is the todo/changelog for the sophomorix sourcecode

**= this is next
* = high priority
- = do that when time comes



============================================================
============================================================
Next meeting
============================================================
============================================================

Bootorder:  postgres -> ldap -> samba, sonst gibts timeout
            (mit dpkg-override samba soll 21 weden)

??? seems to work
    (but has a time delay)

??? samba von thomas:    prepatch   templates modifizieren   postpatch
    schauen was drinstehtund evtl. berücksichtigen

??? pg_hba.conf so, dass auch phpgadmin tut 



============================================================
============================================================
Todo
============================================================
============================================================


############################################################
KNOWN BUGS
############################################################
Bug: a user in dachboden is reactivated by a similar
     (=must be identical) new user



############################################################
DOKUMENTATION To do
############################################################

dokumentation:
   * grafik workflow aktualisieren
   * write how to test sophomorix
      - sophomorix2
      - sophomorix-doc-html
      - perldoc Sophomorix::SophpmorixAPI
   * logging   


############################################################
PACKAGING for DEBIAN To do
############################################################

packaging:
   - Makefile creates directories with correct permissions, 
     how can I package this directories with its permissions?
   - run sophomorix-samba when installing
     (how to get the servername into sophomoeix.conf (netbios-name)??)
   - include common.bat with comments?
   - zusammenspiel mit Thomas cd
   - sophomorix-vampire version x.x braucht sophomorix2 1.2.2
     (das steht in den abhängigkeiten), falls es installiert werden soll (optional)
     andersherum braucht sophomorix-vampire dieselbe Versionsnummer von sophomorix2 
     wie macht man das?
   - sophomorix-base depends on libdbd-csv-perl
     change that to *-files or so
   - run sophomorix-setup-pgldap is not working (locking problem)
   - smbldap tools dependeny fallenlassen?
   - optionen in postinst-scripten upgrade)



???? *.dsc,*.tar.gz,*.changes bei sophomorix-pakete ins source Verzeichnis


Think about: using dbconfig-common


############################################################
SCRIPTS To do
############################################################

sophomorix-repair
   * repair permissions of subclasses and projects 
   - use function create_userlist to specify users
     Call with option -l loginname should be fast (= do only this)
   * update man page
   - group owner in the home directory is lehrer (is this really good?)


sophomorix-quota
   - option --auto-setup
       makes a usable quota-system
       does what it needs to have quota enabled and working
   * option --sum still missing
   - option --school(=pupil, teacher, workstation)
     Use this option in sophomorix-passwd also?
       -> include in function create_userlist
   - check if quota isreally set (how?, grep through 'quota user' ?)
   - find users without quota, report them
   - find users that approch their quota, send mail, ...
   - speedup function login_type using sql instead of getent... 


sophomorix-teach-in (seems ok so far)


sophomorix-shell 
   - change the login-shell of a user
   - configuration files like quota
     (quota.txt, lehrer.txt, class, ...)
   - think about putting this into sophomorix-user as an option (YES)


sophomorix-check
   - what about the shell (/bin/bash) when updating from old files?
   - what about the quota  when updating from old files?
       lehrer.txt: automatically used, when copied
       quota.txt:  automatically used, when copied
       projects:   did not exist, ok
       classes:    schulinfo.txt should be copied/used to class_db
             --> check this
   - add more auto-teach-in
      - exchange of firstname and lastname should be detected automatically
   * filter out users in schueler.txt that have groupname "lehrer" or "teacher"
     for security reasons
   - add use of field 6, upload Field 6 Data automatically into database
      - add entry for every user in user_db: "Department"
      - for every department create entry in department_db
      department_ contains:
         - Name of department i.e. "Hauptschule"
         - Name String, i.e. "HS Sydney", which is used by printing things.
         - Mail suffix, i.e "hs-sydney.de" -> user@hs-sydney.de
         - short name, i.e. "hss"
         - automatisch: Schülerzahl, Klassenzahl ?????? oder besser dynamisch
         - ....
   - Format report.office with latex          
   - include filter-file for different school-administration-sofware
   - throw error, when unid is double in schueler.txt 


sophomorix-add
   - add call sophomorix-quota --noninteractive
   - add user to cyrus (dont't know how to do)
   * dont add group lehrer to class_db
   * add windows-group when unix-group is added
     Command: net groupmap ...
   - add standard linux GUI (kde3 (configurable))
   - when using -l option: login-card could not be created is missleading
     that something went wrong
   - option -i: group users to add by classes alphabetical, users alphabetical
   - create file forbidden.logins which loginnames that are no to be generated
     (root1, root2, root3, ...mysql, ...)
     (All systemusers that could be possible, when installing additional packages) 


sophomorix-move
   - move Data from share into home, even if 'hidden' in another owners directory
   - quick-move of a user(move user with a command, and keep him somehow out of 
     way, when calling sophomorix-move)
   - option -i: group users to add by classes alphabetical, users alphabetical


sophomorix-kill
   - option -i: group users to add by classes alphabetical, users alphabetical


sophomorix-user 
   - wenn user is activated, then add her automatically in her ExitAdminClass, 
     if she is in dachboden 
     or in the class specified by  -c class option
   - Changing a state of a user (make Permanent, Killable, ...)
     by using function create_userlist, i.e. make all pupils killable
   - option --move moves a pupil at once in the new class 
     i.e. (calls sophomorix-move -l loginname)
   - user with status U,E must not be activated?
   - option -i : shows all selected users (should be used with | less)
   - option --activatable (or -i -D -T shows info about Disabled or Tolerated users)
   - when reactivating a user, set a date in the future to keep her longer acctive 
     (optional parameter, configurable)
   - option --clean-account: remove all data from the account, without removing
     the account, password, ... itself (usefol for guest accounts)
   - option --newest shows/modifies users added on the latest day/latest run
   - nicely format (looong) modulelist, when displaying webmin info
   - without option (or option -i or --all): print userlist:
            group1 (2 users):
              user1    group1 U,E
              user2    group1 T,A
            group2 (1 users)
              user1    group2 ... D
              -------------
              num    total

       print all users with option -v
   - group display: separate primary groups from secondary (more logical) or not 
                    (like id -nG user) 

   - create lists of users (move to sophomorix-print)
       - one or more classes, projects, ... or the whole school
       - csv,xls,pdf, ....


sophomorix-split
   - interrupt if class to split is nonexistent
   - check if exchange dir is created
   - check if links are created to exchange dir
   - create commands with only the changes of users to apply. 
     ( like in sophomorix-project, use the same code?)
   - sophomorix-split options: 
        split randomly in 2,3 halves
        split half-half
        split a class into projects(is this necessary?)
   - add some show info stuff
   - add change long name of subclass
   - make sophomorix-split files-independant


sophomorix-passwd
   - generate login-cards with changed passwords automatically
     (passwd_change.pdf)
   - make this an option to sophomorix-user


sophomorix-print
   - print subclass on login-card?
   - what about projects, show project membership?
   * make configurable which print-output sophomorix-print generates 
     to save time (ps, pdf,csv,...)
   - put school-logo on login-card, watermark, ...
   - generate a onepage-printout for teachers (help, mail, webmin-login, ...)
   - root can allow teachers to move his students in a special permanent class
     i.e. to allow some of its students to participate in a wiki permanently
     admin should be able to define an 'veteran project', i.e. 
     m4kb2t --> mkb-veterans


sophomorix-project
   - allow secret or open project(standard)
     secret=no teachers can add himself to a project
     open=teachers can add themselves to a project
   - create exchange directories automatically, when the project is created
   - option -p astro -i should display info about group astro (6users in a row, ...)
   - add status stuff/lifetime stuff to projects
      P= Permanent, will not be automatically removed
      ... see drawing in doku
      when a project is disabled:
       - no data exchange
       - no database access, ...
       - mail to project teacher
       - delete after xxx days (cron-job)
   - when killing a project: 
       - delete line
       - delete exchange dir
       - delete links from users to exchange dir
       - move data back to homedir of user?
   - check if loginname is valid before adding user to a project

   - allow teachers to add a project (if no AddQuota is involved)
     - (maximum of Projects is configurable for each teacher: standard 30)
     - standard final date: one year from now or schoolyears end (if configured)
     - maximum length is 3 years
     - extension of length is possible
     - deleten of a project is only possible as the creator (-> field in database) 

   - allow admin:
     - projects with additional quota
     - permanente projekte
     - delete a project at once
     - push a project ino the deletion cycle (send mail,deactivate,autom. deletion)
     

sophomorix-class
   - show classes in alphabetical order (use list insted of hash, when fetching)   
   - if no class is found,-> message
   - class_db:
     Type:
       A: AdminClass (creted by schueler.txt entries)
       X: ExtraClass (created by extrakurse.txt)
       K: Killable (no users in this class anymore, can be killed)
   --kill  remove a class from database,
           delete the exchange directory
           ...


sophomorix-test
   - include reactivation by sophomrix-user -A
   - include testing the log file.
      - log in different file while testing
      - check this file for correctness
      - remove this file


sophomorix-test-bunchofusers
   - option --exam (distribute, collect, exams)
   - option --split (split a class)
   - option --project (create a project, check members, exam, ...)


sophomorix-vampire:
   * create config-files (perl-syntax):
       - list of files with abs-path to get them from old server
       - file with /path/on/old/server::/path/on/new/server
         sync them automatically

       - /usr/local/samba/progs  -> /home/samba/progs
       - /usr/local/samba/cds    -> /home/samba/cds
       - /usr/local/httpdocs     -> /var/www

   * backup /etc to /etc/sophomorix-vampire
   * backup old login scripts

   * move mail (where to?)
   - move shares
   - option for k necessary?

   - generate a log file what went wrong

   - detect if a non-teacher user has a webmin-login (write to log-file)

   - read passwords from /etc/shadow and /etc/smbpasswd
     - push them into the new accounts
       password-encrypting
       suse:   ?
       debian: md5

   - strategie for rembo:

     garbage that should not be taken to a new system

     images:
     /var/lib/myshn  /usr/local/rembo/files/global/myshn/groups
                                                         hosts
                                                         users
                                                         hdimages
                                                         nicht die patch.*
                                                         Konfigurationsdateien
                                                         Nicht: bin
     rembo beenden
     /var/lib/rembo  /usr/local/rembo/files/shared

     rembo -chkshared zeigt die zu entfernenden an     
     
     konfigurationsdaten:
     rembo.conf
     /etc/myshn ist link

    Projektgruppen nach Anleitung T.Schnitt übernehmen





sophomorix-webmin
   - totally configure webmin
   - option --noninteractive 

   ** ml_account  : Benutzerkonto  (alle user)
   ** ml_teacher  : Unterricht (alle)
   ** ml_admin    : Administration


check: is user taken out of webmin, when she is Disabled? Is this necessary or is the !-sign in /etc/shadow enough?

miniserv.users: letztes Feld : hosts von denen man zugreifen darf 


   -  Be aware: problem group student would need 1 entrys for every student 
       (this will be a very loooooooooong line)

     problem: when a module is added to webmin.users only (own script)
              then this module is NOT added to webmin.acl 
                 -> the user doesnt see this module
           better: create webmin.acl from some configuration files
                   in /usr/sbin (webmin-teacher-modules, ...-admin-, -student-)
                   which can be overwritten by files in /etc/sophomorix/webmin

   - if users are added without webmin installed, root and admin are missing
      - create root,admin, when creating files
      - or better do nothing when they dont exist


   - usermin-modules will be converted to webmin by thomas
       -> usermin is not running on the ml-server
       -> postinstall-script muss sich in gruppe student, teacher eintragen
   -abfrage in sophomorix-webmin, ob paket webmin installiert ist
 
   
sophomorix-mail
   - Eintrag der lehrer in /etc/aliases mit vorname.nachname@...
     wenn das in sophomorix.conf so steht.
     (... wird sich noch ändern (SQL))
   - aliases in postgres (zusätzlich zu /etc/aliases) ????????


sophomorix-teacher
  ** write new script to distribute data, collect data, ...
      --handout -i shows what to hand out
      --collect -i shows what to collect
      options --sync --copy when handing out data
      options --collect-original, --collect-copy when collecting
      --exam
   - read perlsec
   - distribute _Collect to one pupil
   - backups after rsync are temporarily owned by group 'lehrer', 
      because sophomorix does not run setgid root
     (this could cause problems, when using grpquotas (No problem now!))
   - think about copy/delete for rsync
   - how should it be managed to clear a  _Collect directory?
     (dont do this at all?)
   ** update man page

   --common naming with windows,novell ZEN:
     Naming:
       Menu: Klassenarbeiten
             Klassenarbeitsmodus (aktiviert=green, deaktiviert=red)
     - teachers aktivates modus
     - pc-based login (reason: limited gruppenrichtlinien, if used)
     - relogin is impossible
     - no internet   (make it choosable in linux-ml)
     - no exchange dir 
         - users can exchange on writeable programm share
           when bad software must be used thar requires write access
     - no mail
     - collect data in a special dir
     austeilen (homeverzeichnis): - cp data 
                - change the owner
                - 'save' button after editing
     vorlagen (bereitstellen):  - use links to share data 
                - data is readonly  
                - 'save as ...' is necessary

     new features: - select data to distribute 
                     (different groups in one room, exams!)
                   - use empty or known password, 
                     loginscript changes password to arbitrary
                   - after login, student has to type in his name


sophomorix-end-of-year (new script)
   - remove content of share-directories
   - exclude classes of type extra


sophomorix-cron (new script) (runs at night)
   - zip files in /var/log/sophomorix/exam
   - update timestamps
   - run sophomorix-check ??


Functions in SophomorixBase:
   - Put Quota-functions in SophomorixQuota.pm 


SophomorixAPI: 
   - use more complicated data structures to return data (speed)

############################################################
ALL SCRIPTS To do
############################################################

   * convert pupil stuff to student
   - if a class is to be added and the groupname is given to a project already
     make something correct
   - remove global variable alle_verzeichnis_rechte
     (sophomorix-split needs return value, sophomorix-add not ???)
   - /home/share/tasks/dachboden is of no use?
   - remove compatibility-mode to ml 1.1.1
   - log teacher actions (sophomorix-teacher, ... to find out if a teacher 
     account is missused)
   - replace sperrklassen.txt and entfernklassen.txt with filter.txt
   - use lehrer.txt (Field: kurz RealShortName )
   - test csv-output on windows and linux
   - clear a user: (The same as clearing a workstation after the exam)
           - keep his login, passwd, homedir
           - keep entry in database
           - restore directories (sammelordner, ...)
           - restore permissions 
        but:
           - empty its home (with options)
           - delete all mail (with option)
           - delete all files in share dir (with options)
           - linux-dotfiles only (with options)

     (Status C = can be cleared, sophomorix-clear, ...)

   - read the config-files from thomas
     (file:  debconf datenbank, perl-lib zum auslesen benutzen ist dabei)
      - debconf-show linuxmuster-base
         zeigt alle werte von linuxmuster-base
      - echo get cupsys/raw-print | debconf-communicate | awk '{print $2}'
         (' ist shift-#)
         liest einzelne Werte aus

   * creating database file from sophomorix-setup-files??
       removing it from sophomorix-check??
   * remove old stuff: ${schueler_oder_user}.protokoll";
   - remove database/sys dependant code
   * set/check file-permissions at the and of each sophomorix-* run. 
   - shorter verbosity when no verbosity option is given
   * remove old subclass stuff (extrafile to specify subclass)
   * get_xxx functions of sophomorix-repair: give a international name 
     and put it to SophomorixAPI, document it with perldoc 
   - unify the options for all scripts (create rfc), where a common
     naming system is used, i.e what options are used to refer to a AdminClass:
         -c AdminClass --class AdminClass --adminclass AdminClass
         ...
   - add references to all other man pages in every man-page



############################################################
DATABASE To do
############################################################

postgres-integration:
        Postres:
             - dump old database, merge it
                 pg_dump ldap > file.sql

            Questions:
            - Paswort/Access (random password/fixed password)

            ldap.secret: wird gebraucht um luma,ldapadmin, ... zu benutzen
            prüfen, ob konfigurierbar


SQL-DBI/OpenLDAP related:

- Performance: connect once in every script (not in every function)
- Transaction: combine inserts in create_user_entry 
- Load DBI (use:DBI;) only if necessary
- update database: combine select and updates to transaction
- NextFreeUnidId beim update ausnehmen

- typ sophomorixstatus,subclass: Nur 1 Buchstabe(performance ?)(tho)
    
- dont create /var/lib/sophomorix/database when using pgsql

- mail quota in database

- avoid inserting an identical,existing line once again
  --using SQL

- create table my_classes
     uidnumber  -- gidnumber
   (fast access)


sekundäre Gruppenmitgliedschaften ermitteln:

select groups_users.gidnumber,memberuid,uid from groups_users,posix_account where posix_account.gidnumber=(select groups.gidnumber from groups where gid='teachers') AND posix_account.uidnumber=groups_users.memberuid; 



Table groups_managers

Zusatzeintrag, wenn sich lehrer zum admin (manager) einer Gruppe macht.


project_details Attribut: teachers wird auch in groups_managers eingetragen.


(evtl. Driites Feld um festzuhalten wie diese Mitgliedschaft zustande kam)




############################################################
DATABASE Tips
############################################################



############################################################
LDAP To do
############################################################
        Passwort in /etc/ldap.secret   (Zugriff 600)


############################################################
LDAP Tips
############################################################

ldapsearch -x -D "cn=admin,dc=linuxmuster,dc=de" -W


############################################################
SAMBA To do
############################################################

Samba net Befehl ansehen


############################################################
SAMBA Tips
############################################################
samba 3: netbios name ändern
       1. name ändern
       2. restart (samba setzt neue sid)
       2. net setlocalsid alte sid wieder setzen

show info
  -- pdbedit -L         all users
  -- pdbedit -Lv        ausführlich alle user

check samba
  -- smbclient -U user%password -L localhost   (check smb account, see Mail Hoth)
  -- smbclient -N -L localhost    (what for?)



############################################################
IMAP To do
############################################################

imap:  call
system("su --command='mkmaildir' postgres")

check if dir exists /var/lib/imap

paket: cyrus21-imapd

siehe script: /usr/lib/linuxmuster/bin/cyrus-user.pl
aus paket linuxmuster-base

quota for mail


mailbox anlegen siehe sophomorix-add 
Zeile von Thomas


############################################################
IMAP Tips
############################################################



############################################################
MOODLE To do
############################################################

############################################################
MOODLE Tips
############################################################

Blended Learning (E-unterstütztes Lernen im gegens. zu E-learning)

Moodle-Integration:

- authentification method ldap.
- firstname, surname, mailaddress from ldap.(do not update ldap)  
- make group of teachers to creators of new courses per ldap
- make miniteachers not creators, but totors of one course 


Aufgabenformat gift (-> konvertierung zu problectix)


============================================================
============================================================
Think about:
============================================================
============================================================
   - cups 
   - moodle (add users to classes, add teachers to admins)
   - deleting /home/exams
   - restart of nscd (will nscd be running? is restart necessary)
   - use logrotate (debian/logrotate, dh_logrotate)
   - log password changes securely
   - create loginnames initial.name.birthday
     (what about changes to this data)
   - sophomorix-info for ALL users (show my account data)
   - make standard-passwort linux configurable
   - mail: experienced admins should be able to make entrys to
     /etc/aliases without being overriden
     (read aliases first, then add generated stuff)   
   - commands for every user (sophomorix-show-my account, ...)
   - creating a htmlpage with links to all usable public-html's
     (this script updates this page, whenever a teacher opens/closes a 
      users public-html)
   - quick-self-add-mode
   - Mail notification for events (i.e. new student in your class, ...) 
   - use of sperrklassen.txt or entfernen.txt (-> filter.txt)
   - think about getting user in class lists from the database
     for correction of exams, ...
   - think about lehrer.txt handling
   think about ext-lehrer (teacher fo only one class).
     probably needed for vhs-Kurse, etc., ...
   - think about: when a teacher adds/removes herself to a class, 
     add/remove her to a field in class_db
   - think about acl's and their handling in repair-directory
   - think about self adding of users
   - think about grpquota in projects
   - think about manually moving pupils in other classes
      - restrict manually moving to Permanent,Frozen?
      - manually create classes for Permanent
        or automatically create a class permanent, where all Permanent/Frozen users 
        a moved to?
        do they have an exchange directory?
   - think about file-locking (use DBD:CSV - module)
   - Think about removing ALL files of a user when she is deleted
     (find /home/share ... and kill them)
     think about renaming every file in an exchange-directory
     of a user that wil be killed shortly to
       filename.txt   -> will_be_deleted_filename.txt
   - group problems: which group should be primary group
   - easy to hook in prefilter-scripts, that are run automatically
   - create multiple project_db files ???
       1. automatically created projects:  department-spanning
       2. manually created projects by root
       3. Projects created by teachers

Administration software:
   schueler.txt:   class;lastname;firstname;birthday;unid;department;
   lehrer.txt:     class;lastname;firstname;birthday;wish-loginname

Software Vendors:
   - SPLAN
   - IBIS
   - LUSD (mandatory in Hessen, Germany)
   - Schulkartei


libpamount



############################################################
STANDARDS:
############################################################
SCHULKONSOLE:
   - we are using perl (Nov,2005)


Nummern für Dinge(unused at the moment):

0 - unused
1 - highest value first (z.b admin=1, ...user=4)

Status-Tabelle:
id	short_status	long_status
-------------------------------------	
0	unknown		unknown
1	U		usable
2	E		enabled
3	T		tolerated
4	A		activated
5	S		self-activated
6	D		disabled
7	R		removeable
8	K		killable
9	F		frozen
10	P		permanent


############################################################
INSTALLATION TESTSERVER:
############################################################

openldap 2.3.x is necessary (use our package)


A) Installation from Debian CD's
==================================================

1. install debian sarge

2. edit /etc/apt-sources.list

   add deb cvs.bszleo.de/sophomorix ./ 

3. apt-get update   

4. apt-get install sophomorix2 sophomorix-developer

  Hit RETURN to all questions

5. run tho following script:
       sophomorix-test
   this will test your system
   (if all test are ok, you are ready to use your server,
    if not: send mail)



B) Installation from LMZ CD's
==================================================

CD-Installation:
  - boot with option    auto26 or expert26
  - reboot without CD
  - internal NIC: eth1
  - externel NIC  eth0
    (vmware: eth0 is the card on top: briged)
    (vmware: eth1 is the card on the bottom: host only)


############################################################
RELEASES:
############################################################


1.4.x (2005-?-?)


Test am 29.11.2005:

   sophomorix-setup-pgldap

   Options --deb         (debconf-datenbank)
           --file        (/etc/sophomorix/pgldap/pgldap.conf)

           --Kommandozeilenoptionen



   SID: -- Beim erstanlegen in debconf-Datenbank wird SID gespeichert
        -- Beim Netbiosnamen ändern wird  
           vom linuxmuster Setup script

           linuxmuster/sambasid   

        -- Option --force-sid (forced die sid auch in schon 
               vorhandene Usereinträge in pg)


   NETBIOS Name:

         muss von sophomorix-pgldap-setup angepasst werden
         (evtl. mit --new-netbiosname)



   backpgsql zusätzlich im slapd -lml paket von Thomas S.


   SAMBA: user.map-datei nach /etc/samba


   SOPHOMORIX:

        sophomorix-check versucht Maschinenaccounts zu entfernen
        root                   id 0
        Administrator          id 998
        nobody                 id 65534
        
        Workstation Accounts: erkennbar am $ am Ende


        sophomorix-search -s pc$ ergibt use of initialized values
                             nobody


        problem: user werden nicht mit genügend Feldern angelegt

    VERWORFEN    Lösung 1: 
        sophomorix : unter 10000 keinen löschen, ...
        (Problem: nobody hat 65534, ...)
        (Problem: manche Felder unbenutzt)


    VERWORFEN    Lösung 2:
        A) sophomorix-check parst Zusatzdatei in /usr/share/sophomorix/devel
           in der die Dauerhaft im System befindlichen user sind
        B) mit sophomorix-add werden sie angelegt. Zusatzparameter, um bestimmte 
           Eigenschaften einzutragen.



        Lösung 3:

        sophomorix-add so ausbauen, dass per Parameter user angelegt 
        werden können, die den Status P haben (Permanent).
        (oder mit '--line string' eine Zeile übergeben)


???? Todo
        Nur anlegen, falls username noch nicht existiert. ansonst übergehen.
        (Installscript soll mehrmals aufrufbar sein)

        Diese Optionen als 'nur vom Setup-script ausführbar in manpage angeben'

        smbldap-populate



   NEXT: 

        ask T.Hoth about pg_hba.conf for phppgadmin

        uid of "Netbios Domain Administrator":
        instead of root:  Administrator or smbroot
        (less error prone)


        sophomorix-setup-pgldap: database cannot be dropped, if user is connected
        (throw out users or what?)

        function remove_class_db_entry

????? next: create links in Tausch, when user is put in subclass

        Funktionen für API:
         %data=get_userdata(user);
         Schlüssel wie in der Datenbank
         $name = $data{'name'};

         Database fields for cups (what is needed?)

         counting the users when sophomorix-class -i

         SophomorixAPI to select users and groups

         sophomorix-quota
            - project add quota

         look in SophomorixPgLdap what has to be done
           create_project_db

###      continue:  
           1. removing writing into project.db when creating a project
           2. change code to update a project
           3. check if its ok when each project is in class_details


         test login

         $server must be patched in PgLdap.pm

         make sid available in ldap

         save sid in database

         use transactions to modify the database
         (this is more complicated, than I thought)

         add tests to sophomorix-test (check groups, check_provided_files)


   smbpasswd -w password 
       should use cleartest-password from ldap.secret
       (password from )

   
   take care that smbroot cannot be added twice or another user with uid 998   

   - limit rm -rf dir to paths beginning with /home/ when killing users
   - added options smbroot,password to sophomorix-add manpage 
   - Bugfix: loginShell not displayed
   - sophomorix-user displays samba stuff
   - don't show output uid=--- gid=--- in sophomorix-add when 
        uid,gid is not forced from the sophomorix-add file.
   - Differ empty date / year unrealistic / date nonexisting 
     in stdout description and report.office
   - check birthdate for existence with debian package libdate-calc-perl :
       use Date::Calc;
       check_date($year,$month,$day);
     since postgres allows only existing days
   - fixed sophomorix-test to use regex to verify first part (day) 
     of creationdate timestamp
   - added entries in pg_hba.conf
   - checked that: 
     a root script can connect to the database, because it has access 
     via pg_hba.conf and pg_ident.conf

1.4.5-4 (2005-11-29)
   This is the Version tested at the lmz on 2005-11-29    

   - make creationdate a timestamp (datatype: timestamp without time zone)
      like: 2005-11-23 09:44:52.641214
   - adding projects to the database seems to work now
   - modified database for the use of projects
   - dn is updated in the database for existing objects when 
       calling sophomorix-setup-pgldap
   - function show_project_list modified for pgldap



1.4.5 (2005-11-16)

   - Bug: ids (like 10007) in gid (where names are) -> fixed
   - Bugfix: fetch classlist: new function using pg 
   - added replacements for pgldap for:
           groupadd -> create_class_db_entry with second parameter 1 (add subclass)
           adduser  -> pg_adduser
   -  replaced get_group_list (use id) with faster pg_get_group_list(query database)
   - speeded up sophomorix-kill -i accessing pg instead of using id
   - checked that: when killing a user, remove all secondary group memberships
   - show_class_list is deprecated in SophomorixPgLdap.pm
   - function login-type in sophomorix-quota modified for new group-names

   - added options to sophomorix-setup-pgldap: 
           --keep-database 
           --new-database (drops the database and creates an new empty one)
   - added function that exits from script when postgres or
     slapd are not available 
   - view projectdata added

   - view classdata added and checked
   - sophomorix-class displays adminclasses correctly
   - sophomorix-quota
            - is setting quota for admin account on each run correctly
            - does NOT update the database for admin data (admin is in files)


1.4.4 (2005-10-26)
   - package 1.4.4-4 is working on an empty debian system
     (postgres, slapd and samba freshly installed)
   - smbpasswd -w server is setting ldap-password in sophomorix-setup-pgldap
   - modified sophomorix-setup-pgldap to modify
     pg_hba.conf and pg_ident.conf
   - adding a test function to check 
       - if group membership is exactly correct
       - if the collection of links to the exchange directories is correct
   - adding first tests to test directory stucture of a user
     (windows, share, collect, and task)
   - Bugfix in SophomorixBase.pm: using loginname in setup_verzeichnis
     only, when $schueler/$lehrer/$workstation in given in sophomorix.repair 
   - added again info about group in sophomorix-user -s name
   - done a lot in sophomorix quota. sets quota again 
   - uncommented 'checking is user is in system' in sophomorix-user  
   - sophomorix-passwd seems to work now (setting a password of a user)
   - function:  check_sophomorix_user (should work with postgres now)
   - function: backup_user_database (does nothing now)
   - Bugfix: sophomorix-user shows stange errors when webmin is not installed
   - sophomorix-user -s -> search in multiple fields, without doubling
   - get_first_password uses postgres now
   - disable/enable unix-account of a user 
     (append ! to encrypted password/remove ! from encrypted password)
     smbpasswd -e/-d works, use it in scripts.
   - added samba tests
   - /etc/nsswitch.conf: compat ldap for quick logins, when sldap is down
   - checked that bdb package is not needed
   - sophomorix-move: update samba stuff in all relevant places
   - added samba fields for a working login
   - install DB_CONFIG into system, cp at setup to /var/lib/ldap
   - added tests for the correct homedirectory in sophomorix-test 
   - reformatted sophomorix-test output
   - replaced  usermod in sophomorix-move with appropriate stuff, 
     when using pgldap 
   - fixed Bug move old home to new home
   - removed errors from sophomorix-test
   - function update_user_db_entry extended to "Gid=groupname"
   - update gid when moving a user
   - create groups when adding users an group doesn't exist
   - created a salted, crypted userpassword for linux
     (checked that linux login works)
   - linux_gruppe_to_kill in sophomorix-kill is now working
   - checked that View userdata shows gid from primary group
   - moved set_sophomorix-passwd  from SophomorixBase nach Files and Ldap modules
   - wrote new function set_sophomorix-passwd for postgres 
   - print sql commands on console only in logleve 3 (-vv)
   - added a teacher to sophomorix-test
   - sophomorix-test leaves database without modifications (still to test)
   - sophomorix-kill removes users (not homedir)
   - function to killl a user in database and pgldap-module
   - test for Bugfixes:
      - update unid at once, when user reappears with unid
      - delete unid, when user disappears in files or unid is empty   
   - added creation af passwords, still to check, if they work
   - added principal support for samba_sam_account table (fields still empty)
   - delete unid from sys, when entry in files is present, but
     has an empty unid field (test added) 
   - deactivationdate and reactivationdate are emptied
     when not used (NULL)
   - sophomorix-teach-in rewritten to use postgresql
         function get_tech_in-sys-users in SophomorixPgLdap.pm
   - sophomorix-test rewritten to use postgresql
     (130 Tests are OK)
   - sophomorix-add add unid at once, if existent in schueler.txt
   - Replaced/New functions in SophomorixPgLdap.pm
      - connect and disconnect to database
      - create user
      - update user
      - get_sys_users
      - get_print_data
   - use postgresql database instead of files
   - added get_debconf_value to read from the debconf database
   - create packages sophomorix-pgldap and sophomorix-sys-pgldap
   - use module pgldap, when it is set in sophomorix.conf 

   - when a wish-login in lehrer.txt/schueler.txt is given multiple times:
      -> none of the users will be added
      -> error-message 
      -> report.admin entry is created 


1.2.1 (2005-04-08)
   - The following module-names are shown to students,teachers,admin: 
       ml_account  : Benutzerkonto     (alle students)
       ml_teacher  : Unterricht        (all teachers)
       ml_admin    : Administration    (all admins)
   - changed groupname teacher to teachers and /home/reachers
   - changed groupname student to students and /home/students
   - /home/pupil/ -> /home/students 
   - when a user is killed, 
       - move its line(s) from user-modify.log to user-modify-archive.log
          (speed up lookups in user-modify.log)
       - add a kill-entry to the archive to know when a user was killed.
   - history in archive is not sorted according date, it is sorted according users
     (is this fine?)
   - SophomorixBase.pm renamed: append_auto_teach_in_log --> append_teach_in_log
   - sophomorix-user -s string:
     information about webmin-account is displayed 
     (miniserv.users and webmin.acl)
   - sophomorix-add/-kill  call sophomorix-webmin to rewrite the webmin 
     user database (webmin.acl, miniserv.users) 
   - sophomorix-webmin --modules 
     (creates a list of all students/teachers and adds modules from 
      /usr/share/sophomorix/webmin/... to the users) 
   - new option for sophomorix-webmin:
       --loghost 0 / --loghost 1
     (0 makes webmin faster, if DNS is not working)
   - renamed "lehrer" to $DevelConf::teacher (50 times!)
     (seems to work so far)
   - created new file in tmp to pre-filter lehrer.txt:
      /var/lib/sophomorix/tmp/lehrer.txt.tmp
     in wich the grpname lehrer of lehrer.txt is converted to teacher     
   - renamed some files in checkresult:
      user.imsystem        --> sophomorix.system
      report.sekretariat   --> report.office
      report.gesperrt      --> report.filter
      klasse.schuelerzahl  --> AdminClass.students
      extrakurse.schueler  --> extrakurse.students
      schueler.txt.tausch  --> schueler.txt.tmp
   - sophomorix-teacher: --collect added (it worked once)
   - sophomorix-teacher: --handout added (still alpha)
   - no-restart option in sophomorix-webmin added
   - removed option --klassenintern in sophomorix-move 
   - add a user to miniserv.user, when she is added/deleted
   - add/remove a user to webmin.acl when she is added/deleted
   - add a user to webmin.groups when she is created 
     (students and teachers) or when she was created long ago
   - create new users with quota(checked)
   - made sophomorix.conf and sophomorix-devel.conf readable
     for script sophomorix-teacher
   - made tests in sophomorix-developer use the language files as well
   - documented synopsis of SophomorixAPI.pm
   - added various words to the language files
   - creted in /usr/share/sophomorix/lang language files (perl)
   - made a module for configuratuion data SophomorixConfig
   - created function in SophpmorixAPI that returns projects all 
     projects
   - created function in SophpmorixAPI that returns classes that 
     have subclasses
   - sophomorix-split 
     (when classes are split, create tasks and share dirs)
   - moved /home/share/tasks stuff to /home/tasks
     (consistent directory naming)
   - make sophomorix-setup-files create subclass_db
   - updated html-Documentation (some stuff is still missing)
   - sopho-man2html:
       - moved manpages of section 1 to a different directory 
         in the html-documentation
       - included man sophomorix-teacher in the package


1.2.0 (2005-03-09)
   - fixed bugs in sophomorix-test-extra 
   - sophomorix-webmin: added option --auto-logout
   - fixed sopho-man2html: 
         - use man pages of sophomorix-vampire
         - use manpages of scripts with multiple - in their names
   - SophomorixAPI
     - funktion zum schreiben der eingetragenen klassen
     - dito zum lesen, ascibetisch
     - funktion get_all_admin_classes (liest class_db aus)
   - sophomorix-teacher: first release
     adding, removing class from MyAdminClasses
   - sophomorix-webmin: make webmin accessable for every workstation
     /etc/webmin/miniserv.conf
       --all-hosts     
       --localhost     
   - sophomorix-vampire
     - workaround with numerical group id not needed anymore:
        every user and every group gets a new numerical id
     - pushing a vampire key to tho old server works
     - fetching a list of files works
     - adding users works
     - rsync homes works
   - sophomorix-check
     added option --use-uid
     added option --use-gid
     if you want to use the same numerical ids together with 
     --get-info-from-old-files
   - sophomorix-quota
     option --noninteractive added
   - first uncomplete sophomorix-vampire verion
     - distributed in package sophomorix-vampire
     - pushing a key and fetching files
   - Fixed Bug where sophomorix-print generated files in the directory 
     in wich it was called. This made the script abort without producing an error,
     when executed in a nfs mounted read-only filesystem.
   - sophomorix-user -s username
     added options zo the underlying quota command to
       - not show remote filesystems
       - show also unused filesystems
   - rename print-data 
        hinzu.*  -> add.* and others
   - made the database names comply with DBI (sql database table names 
     cannot have a point in them)
     i.e.  user.protokoll -> user_db
           projects.db    -> projects_db
           class.db       -> class_db
           subclasses     -> subclasses_db
   - made the directories under /var/lib/sophomorix international (names)
     i.e.:
      drucken   -> print-data
      pruefen   -> tmp  (because it is created on each run of sophomorix-check)
      dynconfig -> database
      ergebnis  -> check-result
   - added new script sophomorix-class and man page: 
      - -i shows all classes with info
      - --class classname --quota 200+20  sets the quota in database
   - function zeit_stempel: made easier(use ticks), instead of first 
                            writing to a tmp-file and rereading
   - renamed schulinfo.txt to class.db and moved it to the database files
     (renamed again later, see above)     
   - Bugfixes to sophomorix-project: 
         - Don't create links to root
         - Don't add root to unix-group of project
   - complete rewrite of sophomorix-quota to acommodate AddQuota of projects
     (option --sum still missing)
     Quotastring syntax simplified to gain speed:  i.e. 23+45
     (minus sign (-) or x is NOT SUPPORTED ANYMORE)
   - limit sophomorix-quota to (option names as in sophomotix-add) 
       - class(-c), 
       - login ...
       - room
       - ...
   - new function create_userlist($login,$class,$room, ...)
          function can be used in:
               - sophomorix-passwd
               - sophomorix-quota
   - replaced /home/schueler, ... with variables in sophomorix-quota
   - new command sophomorix-passwd (for root)
      - new passwords for all teacher, pupils
      - new password for classes, rooms
      - single users
   - moved all query function of sophomorix-repair to SophomorixAPI and 
     renaming them international
   - added a switch (--no-sync) in sophomorix-check to do/do not an auto-teach-in
   - replacement for sophomorix-teach-in finished
   - show login, admin-class and exit-admin-class when teaching-in
   - include/check new script sophomorix-repair
   - removed variable $samba_dir in repair.directories, ...(not used anymore)
   - The Filesystem under /home is controlled by variables in sophomorix-devel.conf
     repair.directories uses this variable to identify permissions
   - added a few directories under /home/samba
   - sophomorix-setup uses repair.directories to get permissions of directories
   - sophomorix-check with option get-info-from-old-files, that uses data from 
     a previous installation to add users with a former id, gid and login name.
   - option no-kclass disbles removing k from classnames in old group
1.1.6 (2005-01-21)
   - A lot of Bugfixes 

1.1.5 (2005-01-18)
   - First tagged release in the cvs














