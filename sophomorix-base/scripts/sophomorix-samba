#!/usr/bin/perl -w
# Dieses Script (sophomorix-samba) wurde von Rüdiger Beck erstellt
# Es ist freie Software
# Bei Fehlern wenden Sie sich bitte an mich.
# jeffbeck@web.de  oder  jeffbeck@gmx.de


# Bibliotheken
use strict;
use Sophomorix::SophomorixBase;
use Getopt::Long;
Getopt::Long::Configure ("bundling");

# Einlesen der Konfigurationsdatei für Entwickler
{ package DevelConf ; do "/etc/sophomorix/devel/user/sophomorix-devel.conf"}


# ===========================================================================
# netlogon-scripte erstellen
# ==========================================================================

&patch_netlogon("login.bat");

sub patch_netlogon {
    my ($template) = @_;
    my $template_path="${DevelConf::devel_netlogon_template}/$template";
    my $tmp=$template_path."-tmp";
    my $login_path="${DevelConf::devel_netlogon_path}/$template";

    open(TEMPLATE, "<$template_path");
    open(TMP, ">$tmp");
    print TMP "rem Do not edit! Auto-generated by sophomorix-samba \cM\cJ";
     while (<TEMPLATE>) {
        chomp();
        if(/^\###/){next;} # Bei 3-fachen Kommentarzeichen aussteigen
        if(not /^\#/){ 
            # ersetzte netbios name
            s/\$smb_netbios_name/$Conf::smb_netbios_name/g;
        }
        #mac
        #print TMP "$_\l\r";
        #windows
        print TMP "$_\cM\cJ";
        # linux
        #print TMP "$_\n";
     }
     close(TEMPLATE);
     close(TMP);
     system("mv $tmp $login_path");
}





