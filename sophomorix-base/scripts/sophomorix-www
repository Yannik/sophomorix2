#!/usr/bin/perl -w
# $Id$
# Dieses Script (sophomorix-www) wurde von Rüdiger Beck erstellt
# Es ist freie Software
# Bei Fehlern wenden Sie sich bitte an mich.
# jeffbeck@web.de  oder  jeffbeck@gmx.de


# ===========================================================================
# Bibliotheken
# ===========================================================================
use strict;
use Getopt::Long;
Getopt::Long::Configure ("bundling");
use Sophomorix::SophomorixConfig;
use Sophomorix::SophomorixBase qw(
                                  check_options
                                 );
use Sophomorix::SophomorixAPI;
use Sophomorix::SophomorixPgLdap;
use DBI;
use Net::LDAP;
#use Schedule::at;

# ===========================================================================
# Optionen verarbeiten
# ==========================================================================
# Variablen für Optionen
$Conf::log_level=1;
my $help=0;
my $info=0;
$Conf::log_level=1;
my $user_public_upload="";
my $user_public_noupload="";
my $user_private_upload="";
my $user_private_noupload="";


# Parsen der Optionen
my $testopt=GetOptions(
           "help|h" => \$help,
           "info|i" => \$info,
           "verbose|v+" => \$Conf::log_level,
           "user-public-upload=s" => \$user_public_upload,
           "user-public-noupload=s" => \$user_public_noupload,
           "user-private-upload=s" => \$user_private_upload,
           "user-private-noupload=s" => \$user_private_noupload,
          );

# Prüfen, ob Optionen erkannt wurden
&check_options($testopt);




# --help
if ($help==1) {
   # Scriptname ermitteln
   my @list = split(/\//,$0);
   my $scriptname = pop @list;
   # Befehlbeschreibung
   print('
sophomorix-www manages access to public_html and private_html directories

Options
  -h  / --help
  -v  / --verbose
  -vv / --verbose --verbose
  -i  / --info

Managing users (students and teachers):
  --user-public-upload user1,user2,...
  --user-public-noupload user1,user2,... (not for teachers)
  --user-private-upload user1,user2,...
  --user-private-noupload user1,user2,... (not for teachers)

Please see the sophomorix-www(8) man pages for full documentation
');
   print "\n";
   exit;
}

############################################################
# options
############################################################

&check_connections();

# --info
if ($info==1){

   exit;
}


### user

#  --user-public-upload user1,user2,...
if ($user_public_upload ne ""){
    my @users = split(/,/,$user_public_upload);
    foreach my $user (@users){
	&Sophomorix::SophomorixBase::user_public_upload($user);
    }
}

#  --user-public-noupload user1,user2,...
if ($user_public_noupload ne ""){
    my @users = split(/,/,$user_public_noupload);
    foreach my $user (@users){
	&Sophomorix::SophomorixBase::user_public_noupload($user);
    }
}

#  --user-private-upload user1,user2,...
if ($user_private_upload ne ""){
    my @users = split(/,/,$user_private_upload);
    foreach my $user (@users){
	&Sophomorix::SophomorixBase::user_private_upload($user);
    }
}

#  --user-private-noupload user1,user2,...
if ($user_private_noupload ne ""){
    my @users = split(/,/,$user_private_noupload);
    foreach my $user (@users){
	&Sophomorix::SophomorixBase::user_private_noupload($user);
    }
}



